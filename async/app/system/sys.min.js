const { bots } = require('../userConfig/botconfig');

// ALL FUNCTIONS
function startSystem(){
    const fs = require('fs');
    if(!fs.existsSync('./app/mods/')){
        fs.mkdirSync('./app/mods/')
    };
    if(!fs.existsSync('./app/mods_modules/')){
        fs.mkdirSync('./app/mods_modules/')
    };
    if(!fs.existsSync('./app/mods_configs/')){
        fs.mkdirSync('./app/mods_configs/')
    };
    if (!fs.existsSync('./app/users/')) {
        fs.mkdirSync('./app/users/')
    };
    if (!fs.existsSync('./app/projects/')) {
        fs.mkdirSync('./app/projects/')
    };
    if(!fs.existsSync('./app/[ZaysLogger]/')){
        fs.mkdirSync('./app/[ZaysLogger]/')
    };
    if(!fs.existsSync('./app/[ZaysLogger]/discord-api/')){
        fs.mkdirSync('./app/[ZaysLogger]/discord-api')
    };
    if(!fs.existsSync('./app/[ZaysLogger]/system/')){
        fs.mkdirSync('./app/[ZaysLogger]/system')
    };
    const writeToDiscordLogs = fs.writeFileSync('./app/[ZaysLogger]/discord-api/starting_up.log', `Starting Discord-Api`);
    const writeToSystemLogs  = fs.writeFileSync('./app/[ZaysLogger]/system/startUpMsg.log', "System is starting up");
    console.log(`[System]: Setting up work station`)
    setTimeout(() => {
        console.log(`[System]: Checking on some things...`)
        if(bots.A.setActiveBot === true){
            console.log(`[System]: Creating your bot....`)
            if(!fs.existsSync(`./app/projects/${bots.A.name}/`)){
                fs.mkdirSync(`./app/projects/${bots.A.name}/`)
            }
            setTimeout(() => {
                fs.writeFileSync(`./app/projects/${bots.A.name}/bot.main.js`,
                ` 
                const {Client, Collection} = require('discord.js)
                const client = new Client({intents: ["GuildMessages", "Guilds", "GuildMessageTyping"]})
                const commands = new Collection();
                
                // Main Bot
                client.commands = new Collection();
                const commandsPath = path.join(__dirname, './commands');
                const commandFiles = fs.readdirSync(commandsPath).filter(file => file.endsWith('.js'));
                
                for (const file of commandFiles) {
                    const filePath = path.join(commandsPath, file);
                    const command = require(filePath);
                    // Set a new item in the Collection
                    // With the key as the command name and the value as the exported module
                    client.commands.set(command.data.name, command);
                client.on("ready", ()=>{
                    console.log("[script | ${bots.A.name}]: Bot has started")
                })
                client.login('${bots.A.token}')
                
                `
                )
                const writeToDiscordLogs = fs.writeFileSync('./app/[ZaysLogger]/discord-api/createdBot.log', `Discord-api generated a bot for you`);
                const writeToSystemLogs  = fs.writeFileSync('./app/[ZaysLogger]/system/createdFiles.log', "Sytem has created files");
                console.log(`[System]: bot created you can view it at ./app/projects/${bots.A.name}/`)
            }, 10000);
        }else
        if(bots.B.setActiveBot === true){
            console.log(`[System]: Creating your bot....`)
            if(!fs.existsSync(`./app/projects/${bots.A.name}/`)){
                fs.mkdirSync(`./app/projects/${bots.A.name}/`)
            }
            setTimeout(() => {
                fs.writeFileSync(`./projects/${bots.B.name}/bot.main.js`,
                ` 
                const {Client, Collection} = require('discord.js)
                const client = new Client({intents: ["GuildMessages", "Guilds", "GuildMessageTyping"]})
                const commands = new Collection();
                
                // Main Bot
                client.commands = new Collection();
                const commandsPath = path.join(__dirname, './commands');
                const commandFiles = fs.readdirSync(commandsPath).filter(file => file.endsWith('.js'));
                
                for (const file of commandFiles) {
                    const filePath = path.join(commandsPath, file);
                    const command = require(filePath);
                    // Set a new item in the Collection
                    // With the key as the command name and the value as the exported module
                    client.commands.set(command.data.name, command);
                client.on("ready", ()=>{
                    console.log("[script | ${bots.B.name}]: Bot has started")
                })
                client.login('${bots.B.token}')
                
                `
                )
                const writeToDiscordLogs = fs.writeFileSync('./[ZaysLogger]/discord-api/CreatedBot.log', `Discord-api generated a bot for you`);
                const writeToSystemLogs  = fs.writeFileSync('./[ZaysLogger]/system/CreatedFiles.log', "Sytem has created files");
                console.log(`[System]: bot created you can view it at ./app/projects/${bots.B.name}/`)
            }, 10000);
        }else{
            throw "[System]: Must set an active bot"
        }
    }, 2000);
}
function startWelcomer(){
    console.log(
        `
        ### Zays Discord Bot Creator
        ### Version: 1.0.0
        `
    )
    if(cfg.async === true){
        throw 'Async is not supported'
    }else
    if(cfg.version != '1.0.0'){
        throw 'Reinstall ZBC~'
    }

}
function startService(name,callback) {
    console.log(`[System]: Starting ${name}`)
  callback()  
}
module.exports = {
startService,
startSystem,
startWelcomer
}